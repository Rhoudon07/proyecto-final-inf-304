<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movilidad Urbana Santiago</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <!-- Podrías crear un archivo css/style.css para tus estilos -->
  <style>
    body { 
        font-family: sans-serif; 
        margin: 0; 
        display: flex; 
        flex-direction: column; 
        height: 100vh; 
        overflow: hidden; /* Evita el scroll en el body */
    }
    .header {
        padding: 10px 20px;
        background: #fff;
        border-bottom: 1px solid #ddd;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
    }
    .header h1 {
        margin: 0;
        font-size: 1.5em;
        color: #333;
    }
    .header nav ul {
        margin: 0;
        padding: 0;
        list-style: none;
        display: flex;
    }
    .header nav li {
        margin-left: 20px;
    }
    .header nav a {
        text-decoration: none;
        color: #337ab7;
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 4px;
    }
    .header nav a:hover {
        background-color: #f0f0f0;
    }
    /* Contenedor principal para el mapa y el panel lateral */
    .main-content {
        display: flex;
        flex-grow: 1;
        position: relative;
    }
    #map { 
        flex-grow: 1; 
        transition: width 0.3s ease;
    }
    /* Estilos para los botones de control del mapa */
    .map-control-btn {
        position: absolute;
        left: 10px;
        z-index: 401; /* Por encima del mapa pero debajo de otros modales */
        background-color: white;
        border: 2px solid rgba(0,0,0,0.2);
        border-radius: 4px;
        width: 34px;
        height: 34px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #locate-btn {
        top: 10px;
    }
    #reset-view-btn {
        top: 80px; /* 10px (top) + 34px (height) + 10px (margin) */
    }
    /* Estilos para el panel lateral de alertas */
    #alert-panel {
        width: 300px;
        background-color: #fdfdfd;
        border-left: 1px solid #ddd;
        padding: 15px;
        box-sizing: border-box;
        overflow-y: auto;
        display: none; /* Oculto por defecto */
    }
    #alert-panel h2 {
        margin-top: 0;
        font-size: 1.2em;
        color: #333;
    }
    #alert-filters {
        padding: 10px 0;
        border-bottom: 1px solid #ddd;
        margin-bottom: 10px;
    }
    #alert-filters label {
        display: block;
        margin-bottom: 5px;
        cursor: pointer;
    }
    /* Estilos para el Spinner de Carga */
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: #337ab7;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #alert-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    #alert-list li {
        list-style-type: none;
    }
    #alert-list button {
        width: 100%;
        text-align: left;
        background: none;
        border: none;
        border-bottom: 1px solid #eee;
        padding: 10px;
        cursor: pointer;
        font-family: sans-serif;
        font-size: 1em;
    }
    #alert-list button:hover, #alert-list button:focus {
        background-color: #e9ecef;
        outline: 2px solid #337ab7;
    }
    /* Estilos para el Modal */
    .modal {
        display: none; /* Oculto por defecto */
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        border-radius: 8px;
    }
    .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        background: none;
        border: none;
        padding: 0;
        line-height: 1;
    }
    .close-button:focus {
        outline: 2px solid #337ab7;
    }
    .close-button:hover,
    .close-button:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    #report-form textarea {
        width: 100%;
        height: 80px;
        margin-bottom: 10px;
    }
    #report-form button {
        padding: 10px 15px;
    }
    #report-form select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>Movilidad Urbana Santiago</h1>
    <nav>
      <ul>
        <!-- Las opciones "Horarios", "Mapas" y "Puntos de interconexión" están integradas en la vista de rutas -->
        <li><a href="#" id="show-routes">Rutas del Monorriel</a></li>
        <li><a href="#" id="show-alerts">Alertas de Tránsito</a></li>
        <li><a href="#" id="report-alert-btn">Reportar Alerta</a></li>
      </ul>
    </nav>
  </header>
  <main class="main-content">
    <div id="map"></div>
    <button id="locate-btn" class="map-control-btn" title="Centrar en mi ubicación">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="22" y1="12" x2="18" y2="12"></line></svg>
    </button>
    <button id="reset-view-btn" class="map-control-btn" title="Restablecer vista">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
    </button>
    <aside id="alert-panel" aria-live="polite">
      <h2>Alertas Activas</h2>
      <div id="alert-filters">
        <label><input type="checkbox" class="alert-filter-cb" value="accidente" checked> Accidentes</label>
        <label><input type="checkbox" class="alert-filter-cb" value="congestion" checked> Congestión</label>
        <label><input type="checkbox" class="alert-filter-cb" value="obra" checked> Obras</label>
      </div>
      <div id="alert-spinner" class="spinner" role="status" style="display: none;" aria-label="Cargando alertas"></div>
      <ul id="alert-list"></ul>
    </aside>
  </main>

  <!-- El Modal para reportar alertas -->
  <div id="report-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="report-modal-title">
    <div class="modal-content">
      <button class="close-button" aria-label="Cerrar">&times;</button>
      <h2 id="report-modal-title">Reportar Alerta de Tráfico</h2>
      <form id="report-form">
        <input type="hidden" id="report-lat" name="lat">
        <input type="hidden" id="report-lng" name="lng">
        <label for="report-type">Tipo de Alerta:</label><br>
        <select id="report-type" name="tipo" required>
          <option value="" disabled selected>Seleccione un tipo</option>
          <option value="accidente">Accidente</option>
          <option value="congestion">Congestión</option>
          <option value="obra">Obra</option>
        </select><br>
        <label for="report-description">Descripción del incidente:</label><br>
        <textarea id="report-description" name="descripcion" required></textarea><br>
        <button type="submit">Enviar Reporte</button>
      </form>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="js/map.js"></script>
</body>
</html>
